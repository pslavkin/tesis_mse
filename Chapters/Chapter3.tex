\chapter{Diseño e implementación} % Main chapter title

\label{Chapter3}

En este capítulo se desglosan los bloques principales del sistema, se explican los criterios de diseño de cada uno y se resaltan los aspectos mas relevantes de la implementación.

\section{Diseño general del sistema}
\subfiga {0.6}
         {system_blocks2.pdf}
         {Diagrama de bloques del sistema implementado con el objeto de identificar las tecnologías involucradas en cada bloque.}
         {fig:system_blocks2}
   
\section{Interconexión de hardware}
   \subsection{PocketBeagle a NK105}
   \subsection{Camara de video a PocketBeagle}
   \subsection{USB cliente mass storage a NK105}
\section{Kernel de Linux y file system}
   \subsection{Adaptacion del devicetree para PocketBeagle}
   \subsection{Manejador de dispositivo SPI esclavo}
   \subsection{Decodificacion de comandos del LCD}
\section{Aplicación de captura de teclado}
\subsection{Aplicación de rotación y escala de GCode}
\subsection{Algoritmos para reconocimiento de marcas}

\subsection{Intervencion al NK105}

\section{Intervencion al NK105}

   Es importante mencionar que el controlador elejido para el trabajo no cuenta con una API de control y tampoco esta dotado de algun canal de comunicaciones dedicado para tal fin, sin embargo su uso es tan popular y su desempenio es reconocido en la industria, por lo que aun con esta dificultad fue el controlador elegido.
   Para resolver la comunicacion con el controldor se intervio el cable que conecta el mando a distancia con el controlador.
   Este cable cuenta con 2 interfases, una UART que comunica el estado de los botones del mando a distancia y una interfase SPI para el envio de la informacion a la pantalla LCD.
Estas interfases se adaptaron en tension y se conectaron a la SBC para poder procesar los datos como se muestra en la figura \ref{fig:intervencion_mando_distancia}

\subfigab
         %{intervencion_mando_uart}{intervencion_mando_spi}
   {0.45}{no_signal}{comentario}{fig:intervencion_mando_A}
   {0.45}{no_signal}{comentario}{fig:intervencion_mando_B}
         {Mando a distancia del controlador NK105 a) Cominicacion por UART del estado de la botonera b) Envío de datos del controlador al LCD por SPI}
         {fig:intervencion_mando}

En la figura \ref{fig:handheld_uart} se muestran los bloques de software utilizados para procesar la información proveniente del mando a distancia.
   Se aprovecharon los mecanismos de colas y names pipes que ofrece Linux para multiplexar los datos provenientes de la UART del mando a distancia con los datos generados por la propia SBC.


\section{Envio de arvhivos por USB}

\subfigtwotwo
         {0.48}{nkhack1.png} {comentario}
         {0.48}{nkhack2.png} {comentario}
         {0.48}{nkhack3.png} {comentario}
         {0.48}{nkhack3.png} {comentario}
         {Aplicacion web desarrollada para controlar la maquina, transferir archivos, gestionar la deteccion de marcas, visualizar el trabajo a cortar en tiempo real, entre otras utilidades de configuracion.}
         {fig:nkhack}
